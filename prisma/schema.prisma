datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id       String @id @default(uuid())
  name     String
  role     String // 'SOLICITANTE' | 'TESTEADOR'
  requests TestRequest[]
}

model TestRequest {
  id            String   @id @default(uuid())
  createdAt     DateTime @default(now())
  scheduledFor  DateTime
  status        String   // 'PENDING', 'COMPLETED'
  solicitanteId String
  solicitante   User     @relation(fields: [solicitanteId], references: [id])
  workers       Worker[]

  @@index([scheduledFor])
  @@index([solicitanteId])
}

model Worker {
  id           String @id @default(uuid())
  rut          String
  name         String
  costCenter   String
  businessUnit String
  subArea      String
  requestId    String
  testRequest  TestRequest @relation(fields: [requestId], references: [id])
  result       TestResult?

  @@index([businessUnit])
  @@index([subArea])
}

model TestResult {
  id        String @id @default(uuid())
  workerId  String @unique
  worker    Worker @relation(fields: [workerId], references: [id])
  status    String // 'UNSAFE', 'NEUTRAL', 'SAFE'
  isDraft   Boolean @default(true)
  isHistorical Boolean @default(false)
  notes     String?

  @@index([status])
  @@index([isHistorical])
}
